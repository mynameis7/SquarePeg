
<html>
<head>
<title>SquarePeg VR WebApp</title>
<style>
	#canvas {
	position: absolute;
	top: 5; bottom: 5;
	left: 5; right: 5;
	}
	#video {
	position: absolute;
	left: -9999em;
	}
</style>

</head>
<body>
	<div id="video-container">
    <!-- Loading Message -->
    <div id="left-load" class="left">
      <div id="title-l" class="title">Loading Video...</div>
      <div id="message-l" class="message hidden">Try WASD + Q/E</div>
    </div>
    <div id="right-load" class="right">
      <div id="title-r" class="title">Loading Video...</div>
      <div id="message-r" class="message hidden">Try WASD + Q/E</div>
    </div>
    <div id="left-play" class="left hidden">
      <a id="play-l" class="large-play fa fa-play fa-5x"></a>
    </div>
    <div id="right-play" class="right hidden">
      <a id="play-r" class="large-play fa fa-play fa-5x"></a>
    </div>

    <canvas id="glcanvas">
      Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
    </canvas>
    <video class="hidden" preload="auto" id="video" loop="true" webkit-playsinline crossOrigin="anonymous">
      <source src="overpass-clip.mp4" type="video/mp4"></sorce>
      
    </video>
		<div id="video-controls" class="hidden">
          <a id="play-pause" class="fa fa-play icon" title="Play"></a>


          <input type="range" id="seek-bar" value="0">

          <a id="loop" class="fa fa-chain-broken icon" title="Stop Looping"></a>

          <a id="mute" class="fa fa-volume-up icon" title="Mute"></a>

          <a id="recenter" class="fa fa-dot-circle-o icon" title="Recenter"></a>

          <a id="select-local-file" class="fa fa-folder-open icon rfloat" title="Select File"></a>

		  <a id="full-screen" class="fa fa-expand icon rfloat" title="Full Screen"></a>
        </div>

	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js"></script>
	<script src="js/third-party/threejs/StereoEffect.js"></script>
	<script src="js/third-party/threejs/DeviceOrientationControls.js"></script>
	<script src="js/third-party/threejs/OrbitControls.js"></script>
	<script src="js/paper.js"></script>
	
	
	<script>
	var clock = new THREE.Clock();
	init();
	
	function init() {
	renderer = new THREE.WebGLRenderer();
	element = renderer.domElement;
	container = document.getElementById('canvas');
	container.appendChild(element);
	scene = new THREE.Scene();
	}
	
	var sphere = new THREE.SphereGeometry(500, 60, 40);
	sphere.applyMatrix(new THREE.Matrix4().makeScale(-1, 1, 1));
	
	var video = document.getElementById('video');
	function bindPlay () {
	video.play();
	document.body.removeEventListener('click', bindPlay);
	}
	document.body.addEventListener('click', bindPlay, false);
	
	
	var videoTexture = new THREE.VideoTexture(video);
	videoTexture.minFilter = THREE.LinearFilter;
	var videoMaterial = new THREE.MeshBasicMaterial({
	map: videoTexture
	});
	videoMesh = new THREE.Mesh(sphere, videoMaterial);
	
	
	effect = new THREE.StereoEffect(renderer);
	camera = new THREE.PerspectiveCamera(95, 1, 0.001, 700)
	
	camera.position.set(100, 100, 100);
	scene.add(camera);
	
	controls = new THREE.OrbitControls(camera, element);
	controls.rotateUp(Math.PI / 4);
	controls.target.set(
	camera.position.x + 0.1,
	camera.position.y,
	camera.position.z
	);
	controls.noZoom = true;
	controls.noPan = true;
	
	
	function setOrientationControls(e) {
	if (!e.alpha) {
	return;
	}
	controls = new THREE.DeviceOrientationControls(camera, true);
	controls.connect();
	controls.update();
	
	window.removeEventListener('deviceorientation', setOrientationControls, true);
	}
	
	window.addEventListener('deviceorientation', setOrientationControls, true);

	scene.add(videoMesh);
	window.addEventListener('resize', resize, false);
	animate();
	
	function resize () {
	var width = container.offsetWidth;
	var height = container.offsetHeight;
	camera.aspect = width / height;
	camera.updateProjectionMatrix();
	renderer.setSize(width, height);
	effect.setSize(width, height);
	}




	
	function update (dt) {
		resize();
		controls.update(dt);
	}
	
	function render () {
		effect.render(scene, camera);
	}
	
	function animate () {
		requestAnimationFrame(animate);
		update(clock.getDelta());
		render();
	}
	
	function fullscreen () {
		if (container.requestFullscreen) {
		container.requestFullscreen();
		} else if (container.msRequestFullscreen) {
		container.msRequestFullscreen();
		} else if (container.mozRequestFullScreen) {
		container.mozRequestFullScreen();
		} else if (container.webkitRequestFullscreen) {
		container.webkitRequestFullscreen();
		}
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	</script>
	
</body>
</html>